id: silent-User attempted to connect from a suspicious country
version: -1
name: silent-User attempted to connect from a suspicious country
description: |
  This playbook addresses the following alerts:
  - User successfully connected from a suspicious country

  Playbook Stages:

  Triage:
  - Retrieve detailed event information about the suspicious country connection attempt.

  Investigation:
  - Check source IP reputation and prevalence in the organization to determine if the IP is known malicious or rarely seen.
  - Analyze user risk score and check for risky user detections in Azure AD or suspicious activity logs in Okta.
  - Search for related alerts in the same case that may indicate user compromise (SSO abuse, unusual VPN connections, password reset attempts).
  - Examine user agent strings for suspicious automation tools or non-standard browsers.
  - Verify MFA usage during the authentication attempt by querying Azure Log Analytics or Okta System Log.
  - Check for suspicious user activity patterns in authentication logs (account locks, bypass attempts, token abuse).
  - Analyze connection history to determine if the country is unusual for the user or organization.

  Containment:
  - The playbook automatically clears active user sessions in Azure AD or Okta to prevent continued access from the suspicious location.
  - For alerts determined to be true positives (based on evidence analysis), the playbook prompts analysts to suspend/disable the user account.
  - Upon analyst approval: Suspend the user in Okta or disable the account in Azure AD.
  - For unsupported authentication systems, provides manual remediation guidance including session termination, password reset, and conditional access policies.

  Requirements:

  For response actions, you need one of the following integrations:
  - Okta v2 (for Okta-based authentication systems)
  - Microsoft Graph User (for Azure AD-based authentication systems)
starttaskid: "0"
tasks:
  "0":
    id: "0"
    taskid: 3f7fe4b8-74c8-478e-8b80-482ece880506
    type: start
    task:
      id: 3f7fe4b8-74c8-478e-8b80-482ece880506
      version: -1
      name: ""
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "3"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 450,
          "y": 26
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "1":
    id: "1"
    taskid: f8ca3afe-bbbd-42cc-93d4-63aead7fb031
    type: regular
    task:
      id: f8ca3afe-bbbd-42cc-93d4-63aead7fb031
      version: -1
      name: Check source IP reputation
      description: Enriches the external source IP of the attack to check if it's known as malicious. Skips on errors for cases where the IP address or the !ip command is empty.
      script: '|||ip'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "50"
    scriptarguments:
      ip:
        simple: ${alert.localip}
    reputationcalc: 2
    separatecontext: false
    continueonerror: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 639,
          "y": 652
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "2":
    id: "2"
    taskid: c227abea-081a-4c8d-a695-5feccbbe57ce
    type: regular
    task:
      id: c227abea-081a-4c8d-a695-5feccbbe57ce
      version: -1
      name: Get logon event information
      description: Returns information about each alert ID.
      script: '|||core-get-cloud-original-alerts'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "4"
    scriptarguments:
      alert_ids:
        simple: ${alert.id}
      filter_alert_fields:
        simple: "false"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 450,
          "y": 289
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "3":
    id: "3"
    taskid: 9300147b-77c4-40e7-99f6-12e3f9d33fc3
    type: title
    task:
      id: 9300147b-77c4-40e7-99f6-12e3f9d33fc3
      version: -1
      name: Triage
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "2"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 450,
          "y": 167
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "4":
    id: "4"
    taskid: 35244a2c-074b-47fd-9ef3-eac638b40962
    type: title
    task:
      id: 35244a2c-074b-47fd-9ef3-eac638b40962
      version: -1
      name: Investigation
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "19"
      - "17"
      - "18"
      - "23"
      - "20"
      - "70"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 450,
          "y": 400
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "5":
    id: "5"
    taskid: b229bd83-82d7-4f3f-a015-32e04e1dca26
    type: regular
    task:
      id: b229bd83-82d7-4f3f-a015-32e04e1dca26
      version: -1
      name: Get source IP prevalence
      description: Get the prevalence of an ip, identified by ip_address.
      script: '|||core-get-IP-analytics-prevalence'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "49"
    scriptarguments:
      ip_address:
        simple: ${alert.localip}
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 245,
          "y": 652
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "6":
    id: "6"
    taskid: 1164cdd0-3571-439b-8c8e-735191b5b5f6
    type: regular
    task:
      id: 1164cdd0-3571-439b-8c8e-735191b5b5f6
      version: -1
      name: Search case for additional alerts
      description: ""
      scriptName: SearchAlertsV2
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "52"
    scriptarguments:
      fromdate:
        simple: 1 day ago
      ignore-outputs:
        simple: "false"
      query:
        complex:
          root: alert
          accessor: parentXDRIncident
          transformers:
          - operator: Cut
            args:
              delimiter:
                value:
                  simple: '-'
              fields:
                value:
                  simple: "2"
          - operator: concat
            args:
              prefix:
                value:
                  simple: 'caseid:'
              suffix:
                value:
                  simple: ' and (name:"A user accessed multiple unusual resources via SSO" or name:"Abnormal first access to a resource via SSO in the organization" or name:"A user connected to a VPN from a suspicious country" or name:"Suspicious Okta account reset password attempt" or name:"Unusual Azure AD interactive sign-in using PowerShell")'
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1047,
          "y": 652
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "8":
    id: "8"
    taskid: 03ff2c11-3045-456d-8c4a-2c11333d1e5d
    type: regular
    task:
      id: 03ff2c11-3045-456d-8c4a-2c11333d1e5d
      version: -1
      name: Get risky user detections
      description: Returns a comma-separated list of the Risk Detection objects and their properties.
      script: '|||azure-risky-users-risk-detections-list'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "10"
    scriptarguments:
      detected_date_time_after:
        simple: ${TimeNow}
    separatecontext: false
    continueonerror: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -1860.75,
          "y": 1031
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: true
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "9":
    id: "9"
    taskid: ae781de3-70bf-438c-85b1-b3a6dbeb64e5
    type: regular
    task:
      id: ae781de3-70bf-438c-85b1-b3a6dbeb64e5
      version: -1
      name: Generate search timestamp
      description: Retrieves the current date and time for use in the search.
      scriptName: GetTime
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "8"
    scriptarguments:
      dateFormat:
        simple: ISO
      daysAgo:
        simple: "2"
    separatecontext: false
    continueonerror: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -1860.75,
          "y": 905
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "10":
    id: "10"
    taskid: 8b72f6f7-ad8f-444f-ab16-99e08b4ab160
    type: regular
    task:
      id: 8b72f6f7-ad8f-444f-ab16-99e08b4ab160
      version: -1
      name: Save detection results
      description: Saves a context key with a value of 1 if the user is risky in Azure AD, 0 otherwise.
      scriptName: SetAndHandleEmpty
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "35"
    scriptarguments:
      append:
        simple: "true"
      key:
        simple: AzureRiskyUserDetections
      value:
        complex:
          root: AzureRiskyUsers.RiskDetection
          filters:
          - - operator: isEqualString
              left:
                value:
                  simple: AzureRiskyUsers.RiskDetection.userPrincipalName
                iscontext: true
              right:
                value:
                  simple: Core.OriginalAlert.event.auth_identity
                iscontext: true
              ignorecase: true
          - - operator: isEqualString
              left:
                value:
                  simple: AzureRiskyUsers.RiskDetection.riskState
                iscontext: true
              right:
                value:
                  simple: atRisk
              ignorecase: true
            - operator: isEqualString
              left:
                value:
                  simple: AzureRiskyUsers.RiskDetection.riskState
                iscontext: true
              right:
                value:
                  simple: confirmedCompromised
              ignorecase: true
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -1860.75,
          "y": 1149
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "12":
    id: "12"
    taskid: da57d33d-efd7-417c-9d36-6b7376e7c812
    type: title
    task:
      id: da57d33d-efd7-417c-9d36-6b7376e7c812
      version: -1
      name: User Risk Detections
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "35"
      - "9"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -1860.75,
          "y": 790
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "14":
    id: "14"
    taskid: 07e7eeef-aa93-4a36-afc6-ca050c7cc394
    type: regular
    task:
      id: 07e7eeef-aa93-4a36-afc6-ca050c7cc394
      version: -1
      name: Get user risk score
      description: This script gathers user data from multiple integrations and returns an Account entity with consolidated information to the context.
      scriptName: get-user-data
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "47"
    scriptarguments:
      user_name:
        complex:
          root: alert
          accessor: username
          transformers:
          - operator: LastArrayElement
    separatecontext: false
    continueonerror: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -166.75,
          "y": 652
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "17":
    id: "17"
    taskid: 5132babb-0448-4279-8fa6-5ab130f75f71
    type: title
    task:
      id: 5132babb-0448-4279-8fa6-5ab130f75f71
      version: -1
      name: Source IP
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "1"
      - "5"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 450,
          "y": 520
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "18":
    id: "18"
    taskid: 827c5d5a-e730-4eb5-8975-9705ae0d2a09
    type: title
    task:
      id: 827c5d5a-e730-4eb5-8975-9705ae0d2a09
      version: -1
      name: User Risk
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "14"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -166.75,
          "y": 520
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "19":
    id: "19"
    taskid: 5c5320b2-e724-4793-bf69-6e59b2e5c284
    type: title
    task:
      id: 5c5320b2-e724-4793-bf69-6e59b2e5c284
      version: -1
      name: Related Alerts
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "6"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1047,
          "y": 520
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "20":
    id: "20"
    taskid: 9b384a74-9e34-4ffa-8984-f1c722f402ba
    type: condition
    task:
      id: 9b384a74-9e34-4ffa-8984-f1c722f402ba
      version: -1
      name: Check source vendor
      description: ""
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      Azure:
      - "21"
      Okta:
      - "22"
    separatecontext: false
    conditions:
    - label: Azure
      condition:
      - - operator: isEqualString
          left:
            value:
              simple: Core.OriginalAlert.raw_abioc.event.auth_server
            iscontext: true
          right:
            value:
              simple: Azure
          ignorecase: true
    - label: Okta
      condition:
      - - operator: isEqualString
          left:
            value:
              simple: Core.OriginalAlert.raw_abioc.event.auth_server
            iscontext: true
          right:
            value:
              simple: Okta
          ignorecase: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -1605,
          "y": 520
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "21":
    id: "21"
    taskid: c72fa881-5e71-430f-b0d3-4fc75a7c753e
    type: title
    task:
      id: c72fa881-5e71-430f-b0d3-4fc75a7c753e
      version: -1
      name: Azure
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "36"
      - "12"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -2051,
          "y": 666
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "22":
    id: "22"
    taskid: e326965a-e55c-4808-8111-01132c4cc001
    type: title
    task:
      id: e326965a-e55c-4808-8111-01132c4cc001
      version: -1
      name: Okta
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "37"
      - "27"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -1147,
          "y": 666
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "23":
    id: "23"
    taskid: 36db9f3f-f597-45ff-9367-b543f3a97f13
    type: title
    task:
      id: 36db9f3f-f597-45ff-9367-b543f3a97f13
      version: -1
      name: User Agent
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "24"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1465,
          "y": 520
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "24":
    id: "24"
    taskid: 722e261a-11ae-4eaf-aa68-b67dc51b867a
    type: condition
    task:
      id: 722e261a-11ae-4eaf-aa68-b67dc51b867a
      version: -1
      name: Check for a suspicious user agent
      description: ""
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "54"
      Suspicious:
      - "53"
    separatecontext: false
    conditions:
    - label: Suspicious
      condition:
      - - operator: isNotEmpty
          left:
            value:
              complex:
                root: Core.OriginalAlert.event.action_user_agent
                filters:
                - - operator: match
                    left:
                      value:
                        simple: Core.OriginalAlert.event.action_user_agent
                      iscontext: true
                    right:
                      value:
                        simple: \b(Python-urllib|libwww-perl|Scrapy|curl|Wget|sqlmap|Nikto|Xrumer|Hydra|JohnTheRipper|LOIC|HOIC|MJ12bot|Baiduspider|BlackWidow|HeadlessChrome|PhantomJS|Selenium|python-requests|node-fetch|PostmanRuntime|GuzzleHttp)\b
            iscontext: true
          right:
            value: {}
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1465,
          "y": 652
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "25":
    id: "25"
    taskid: a73b815b-4a25-404f-823b-b8fbc525d69d
    type: regular
    task:
      id: a73b815b-4a25-404f-823b-b8fbc525d69d
      version: -1
      name: Search for suspicious user activity
      description: Gets logs by providing optional filters.
      script: '|||okta-get-logs'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "43"
    scriptarguments:
      extend-context:
        simple: OktaSuspiciousActivityLogs=
      filter:
        simple: (outcome.result eq "SUCCESS" AND (eventType eq "app.oauth2.client_id_rate_limit_warning" OR eventType eq "user.mfa.attempt_bypass")) OR (outcome.result eq "FAILURE" AND (eventType eq "user.account.lock" OR eventType eq "user.authentication.auth_via_social" OR eventType eq "user.account.unlock" OR eventType eq "user.account.use_token" OR eventType eq "app.oauth2.token.grant" OR eventType eq "app.oauth2.as.evaluate.claim" OR eventType eq "app.oauth2.as.token.revoke")) AND actor.alternateId eq "${Core.OriginalAlert.event.auth_normalized_user.upn}"
      ignore-outputs:
        simple: "true"
      since:
        complex:
          root: alert
          accessor: created
          transformers:
          - operator: ModifyDateTime
            args:
              variation:
                value:
                  simple: 5 hours ago
      until:
        simple: ${alert.created}
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -1365,
          "y": 929
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: true
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "27":
    id: "27"
    taskid: dd7736a5-94b0-4fa0-a5b2-7412d77a8d13
    type: title
    task:
      id: dd7736a5-94b0-4fa0-a5b2-7412d77a8d13
      version: -1
      name: Suspicious User Activity Logs
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "25"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -1365,
          "y": 790
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "28":
    id: "28"
    taskid: c6bb5bd7-fa0f-462f-b09d-3aa45a6f3a10
    type: regular
    task:
      id: c6bb5bd7-fa0f-462f-b09d-3aa45a6f3a10
      version: -1
      name: Search auth logs for user MFA
      description: Gets logs by providing optional filters.
      script: '|||okta-get-logs'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "45"
    scriptarguments:
      extend-context:
        simple: OktaMFALogs=
      filter:
        simple: outcome.result eq "SUCCESS" AND actor.alternateId eq "${Core.OriginalAlert.event.auth_normalized_user.upn}" AND client.ipAddress eq  "${Core.OriginalAlert.event.action_local_ip}" AND eventType eq "user.authentication.auth_via_mfa"
      ignore-outputs:
        simple: "true"
      since:
        complex:
          root: alert
          accessor: created
          transformers:
          - operator: ModifyDateTime
            args:
              variation:
                value:
                  simple: 30 min ago
      until:
        simple: ${alert.created}
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -719,
          "y": 1031
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: true
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "29":
    id: "29"
    taskid: 7a63d462-b7e2-4a4b-994d-949936b9b561
    type: regular
    task:
      id: 7a63d462-b7e2-4a4b-994d-949936b9b561
      version: -1
      name: Search for user MFA Sign-in Logs
      description: Executes an Analytics query for data.
      script: '|||azure-log-analytics-execute-query'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "46"
    scriptarguments:
      query:
        simple: |
          let targetUserUPN = "${Core.OriginalAlert.raw_abioc.event.auth_normalized_user.upn}";
          let specificTimeISO = ${alert.created};

          let endTime = todatetime(specificTimeISO);
          let startTime = endTime - 30m;

          SigninLogs
          | where TimeGenerated between (startTime .. endTime)
          | where ResultType == 0
          | where AuthenticationRequirement == "multiFactorAuthentication"
          | where UserPrincipalName =~ targetUserUPN
          | where IPAddress == "${Core.OriginalAlert.event.action_local_ip}"
      timeout:
        simple: "20"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -2279,
          "y": 1031
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: true
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "31":
    id: "31"
    taskid: 4e26f423-5631-499a-aa10-26ec8213976c
    type: regular
    task:
      id: 4e26f423-5631-499a-aa10-26ec8213976c
      version: -1
      name: Save MFA usage to evidence
      description: Only if Azure Log Analytics is available and no MFA logs were found - we will save the "AzureNoMFA" key as True - indicating that we know the user did not use MFA to authenticate.
      scriptName: SetAndHandleEmpty
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "56"
    scriptarguments:
      append:
        simple: "true"
      key:
        simple: Evidence.AzureNoMFA
      value:
        simple: "False"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -2672,
          "y": 1272
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "32":
    id: "32"
    taskid: 30d5c6a1-8fd1-4538-b0db-e5aca2857cbf
    type: condition
    task:
      id: 30d5c6a1-8fd1-4538-b0db-e5aca2857cbf
      version: -1
      name: Check Azure Log Analytics availability
      description: Returns 'yes' if integration brand is available. Otherwise returns 'no'.
      scriptName: IsIntegrationAvailable
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      "no":
      - "31"
      "yes":
      - "29"
    scriptarguments:
      brandname:
        simple: Azure Log Analytics
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -2279,
          "y": 904
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "33":
    id: "33"
    taskid: a6857825-7267-46d7-84b6-b10adcb98165
    type: regular
    task:
      id: a6857825-7267-46d7-84b6-b10adcb98165
      version: -1
      name: Save MFA usage to evidence
      description: "Set a value in context under the key you entered. If no value is entered, the script doesn't do anything.\n\nThis automation runs using the default Limited User role, unless you explicitly change the permissions.\nFor more information, see the section about permissions here:\n- For Cortex XSOAR 6 see https://docs-cortex.paloaltonetworks.com/r/Cortex-XSOAR/6.x/Cortex-XSOAR-Playbook-Design-Guide/Automations \n- For Cortex XSOAR 8 Cloud see https://docs-cortex.paloaltonetworks.com/r/Cortex-XSOAR/8/Cortex-XSOAR-Cloud-Documentation/Create-a-script\n- For Cortex XSOAR 8.7 On-prem see https://docs-cortex.paloaltonetworks.com/r/Cortex-XSOAR/8.7/Cortex-XSOAR-On-prem-Documentation/Create-a-script"
      scriptName: SetAndHandleEmpty
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "56"
    scriptarguments:
      append:
        simple: "true"
      key:
        simple: Evidence.AzureNoMFA
      value:
        simple: "True"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -2277,
          "y": 1272
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "35":
    id: "35"
    taskid: 22d0fe29-a9a9-4cf5-b845-cd120cdd94d6
    type: regular
    task:
      id: 22d0fe29-a9a9-4cf5-b845-cd120cdd94d6
      version: -1
      name: Save risk detections to evidence
      description: "Set a value in context under the key you entered. If no value is entered, the script doesn't do anything.\n\nThis automation runs using the default Limited User role, unless you explicitly change the permissions.\nFor more information, see the section about permissions here:\n- For Cortex XSOAR 6 see https://docs-cortex.paloaltonetworks.com/r/Cortex-XSOAR/6.x/Cortex-XSOAR-Playbook-Design-Guide/Automations \n- For Cortex XSOAR 8 Cloud see https://docs-cortex.paloaltonetworks.com/r/Cortex-XSOAR/8/Cortex-XSOAR-Cloud-Documentation/Create-a-script\n- For Cortex XSOAR 8.7 On-prem see https://docs-cortex.paloaltonetworks.com/r/Cortex-XSOAR/8.7/Cortex-XSOAR-On-prem-Documentation/Create-a-script"
      scriptName: SetAndHandleEmpty
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "56"
    scriptarguments:
      append:
        simple: "true"
      key:
        simple: Evidence.AzureRiskyUserDetections
      value:
        simple: '${.=val.AzureRiskyUserDetections ? "True" : "False"}'
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -1860.75,
          "y": 1272
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "36":
    id: "36"
    taskid: 39ef79ca-90e3-4013-b56a-73befcea06e5
    type: title
    task:
      id: 39ef79ca-90e3-4013-b56a-73befcea06e5
      version: -1
      name: MFA Verification
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "32"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -2279,
          "y": 790
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "37":
    id: "37"
    taskid: fd5dd492-36cf-481e-b653-0fb033fcc9c2
    type: title
    task:
      id: fd5dd492-36cf-481e-b653-0fb033fcc9c2
      version: -1
      name: MFA Verification
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "38"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -719,
          "y": 790
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "38":
    id: "38"
    taskid: 82ae44e2-e5cd-4943-82a4-149a05f6d543
    type: condition
    task:
      id: 82ae44e2-e5cd-4943-82a4-149a05f6d543
      version: -1
      name: Check Okta v2 availability
      description: Returns 'yes' if integration brand is available. Otherwise returns 'no'.
      scriptName: IsIntegrationAvailable
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      "no":
      - "41"
      "yes":
      - "28"
    scriptarguments:
      brandname:
        simple: Okta v2
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -719,
          "y": 893
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "39":
    id: "39"
    taskid: 1ebf90cd-3d1b-4504-9d7d-1764ad75f886
    type: regular
    task:
      id: 1ebf90cd-3d1b-4504-9d7d-1764ad75f886
      version: -1
      name: Save MFA usage to evidence
      description: "Set a value in context under the key you entered. If no value is entered, the script doesn't do anything.\n\nThis automation runs using the default Limited User role, unless you explicitly change the permissions.\nFor more information, see the section about permissions here:\n- For Cortex XSOAR 6 see https://docs-cortex.paloaltonetworks.com/r/Cortex-XSOAR/6.x/Cortex-XSOAR-Playbook-Design-Guide/Automations \n- For Cortex XSOAR 8 Cloud see https://docs-cortex.paloaltonetworks.com/r/Cortex-XSOAR/8/Cortex-XSOAR-Cloud-Documentation/Create-a-script\n- For Cortex XSOAR 8.7 On-prem see https://docs-cortex.paloaltonetworks.com/r/Cortex-XSOAR/8.7/Cortex-XSOAR-On-prem-Documentation/Create-a-script"
      scriptName: SetAndHandleEmpty
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "56"
    scriptarguments:
      append:
        simple: "true"
      key:
        simple: Evidence.OktaNoMFA
      value:
        simple: "True"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -719,
          "y": 1289
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "41":
    id: "41"
    taskid: 43a653d0-e0e8-4383-8f55-36a5b7acc098
    type: regular
    task:
      id: 43a653d0-e0e8-4383-8f55-36a5b7acc098
      version: -1
      name: Save MFA usage to evidence
      description: "Set a value in context under the key you entered. If no value is entered, the script doesn't do anything.\n\nThis automation runs using the default Limited User role, unless you explicitly change the permissions.\nFor more information, see the section about permissions here:\n- For Cortex XSOAR 6 see https://docs-cortex.paloaltonetworks.com/r/Cortex-XSOAR/6.x/Cortex-XSOAR-Playbook-Design-Guide/Automations \n- For Cortex XSOAR 8 Cloud see https://docs-cortex.paloaltonetworks.com/r/Cortex-XSOAR/8/Cortex-XSOAR-Cloud-Documentation/Create-a-script\n- For Cortex XSOAR 8.7 On-prem see https://docs-cortex.paloaltonetworks.com/r/Cortex-XSOAR/8.7/Cortex-XSOAR-On-prem-Documentation/Create-a-script"
      scriptName: SetAndHandleEmpty
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "56"
    scriptarguments:
      append:
        simple: "true"
      key:
        simple: Evidence.OktaNoMFA
      value:
        simple: "False"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -318,
          "y": 1289
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "42":
    id: "42"
    taskid: bdb5b156-ada4-40c6-97f3-2e0f05b9146b
    type: regular
    task:
      id: bdb5b156-ada4-40c6-97f3-2e0f05b9146b
      version: -1
      name: Save suspicious activity to evidence
      description: "Set a value in context under the key you entered. If no value is entered, the script doesn't do anything.\n\nThis automation runs using the default Limited User role, unless you explicitly change the permissions.\nFor more information, see the section about permissions here:\n- For Cortex XSOAR 6 see https://docs-cortex.paloaltonetworks.com/r/Cortex-XSOAR/6.x/Cortex-XSOAR-Playbook-Design-Guide/Automations \n- For Cortex XSOAR 8 Cloud see https://docs-cortex.paloaltonetworks.com/r/Cortex-XSOAR/8/Cortex-XSOAR-Cloud-Documentation/Create-a-script\n- For Cortex XSOAR 8.7 On-prem see https://docs-cortex.paloaltonetworks.com/r/Cortex-XSOAR/8.7/Cortex-XSOAR-On-prem-Documentation/Create-a-script"
      scriptName: SetAndHandleEmpty
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "56"
    scriptarguments:
      append:
        simple: "true"
      key:
        simple: Evidence.OktaSuspiciousActivityLogs
      value:
        simple: "True"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -1365,
          "y": 1219
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "43":
    id: "43"
    taskid: f5747d80-ab02-4558-990c-58483eeb9ed5
    type: condition
    task:
      id: f5747d80-ab02-4558-990c-58483eeb9ed5
      version: -1
      name: Check if logs were returned
      description: ""
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "44"
      "yes":
      - "42"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              simple: OktaSuspiciousActivityLogs
            iscontext: true
          right:
            value: {}
      - - operator: notContainsGeneral
          left:
            value:
              simple: OktaSuspiciousActivityLogs
            iscontext: true
          right:
            value:
              simple: No logs found
          ignorecase: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -1365,
          "y": 1051
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "44":
    id: "44"
    taskid: 42f384ef-74c6-47e1-bce0-9aa91d33b6a7
    type: regular
    task:
      id: 42f384ef-74c6-47e1-bce0-9aa91d33b6a7
      version: -1
      name: Save suspicious activity to evidence
      description: "Set a value in context under the key you entered. If no value is entered, the script doesn't do anything.\n\nThis automation runs using the default Limited User role, unless you explicitly change the permissions.\nFor more information, see the section about permissions here:\n- For Cortex XSOAR 6 see https://docs-cortex.paloaltonetworks.com/r/Cortex-XSOAR/6.x/Cortex-XSOAR-Playbook-Design-Guide/Automations \n- For Cortex XSOAR 8 Cloud see https://docs-cortex.paloaltonetworks.com/r/Cortex-XSOAR/8/Cortex-XSOAR-Cloud-Documentation/Create-a-script\n- For Cortex XSOAR 8.7 On-prem see https://docs-cortex.paloaltonetworks.com/r/Cortex-XSOAR/8.7/Cortex-XSOAR-On-prem-Documentation/Create-a-script"
      scriptName: SetAndHandleEmpty
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "56"
    scriptarguments:
      append:
        simple: "true"
      key:
        simple: Evidence.OktaSuspiciousActivityLogs
      value:
        simple: "False"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -1157,
          "y": 1349
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "45":
    id: "45"
    taskid: 9dd03754-3a8e-4c97-be96-fa18d586cc18
    type: condition
    task:
      id: 9dd03754-3a8e-4c97-be96-fa18d586cc18
      version: -1
      name: Check if logs were returned
      description: ""
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "39"
      "yes":
      - "41"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              simple: OktaMFALogs
            iscontext: true
          right:
            value: {}
      - - operator: notContainsGeneral
          left:
            value:
              simple: OktaMFALogs
            iscontext: true
          right:
            value:
              simple: No logs found
          ignorecase: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -719,
          "y": 1151
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "46":
    id: "46"
    taskid: c361453e-6317-472c-962d-afb760486f31
    type: condition
    task:
      id: c361453e-6317-472c-962d-afb760486f31
      version: -1
      name: Check if MFA logs were returned
      description: ""
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "33"
      "yes":
      - "31"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              simple: AzureLogAnalytics.Query.Data
            iscontext: true
          right:
            value: {}
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -2279,
          "y": 1151
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "47":
    id: "47"
    taskid: d25cb09a-9ce1-4e30-b8a7-1e8a184484a8
    type: regular
    task:
      id: d25cb09a-9ce1-4e30-b8a7-1e8a184484a8
      version: -1
      name: Save risky user result
      description: "Set a value in context under the key you entered. If no value is entered, the script doesn't do anything.\n\nThis automation runs using the default Limited User role, unless you explicitly change the permissions.\nFor more information, see the section about permissions here:\n- For Cortex XSOAR 6 see https://docs-cortex.paloaltonetworks.com/r/Cortex-XSOAR/6.x/Cortex-XSOAR-Playbook-Design-Guide/Automations \n- For Cortex XSOAR 8 Cloud see https://docs-cortex.paloaltonetworks.com/r/Cortex-XSOAR/8/Cortex-XSOAR-Cloud-Documentation/Create-a-script\n- For Cortex XSOAR 8.7 On-prem see https://docs-cortex.paloaltonetworks.com/r/Cortex-XSOAR/8.7/Cortex-XSOAR-On-prem-Documentation/Create-a-script"
      scriptName: SetAndHandleEmpty
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "48"
    scriptarguments:
      key:
        simple: HighRiskUsername
      value:
        complex:
          root: UserData
          filters:
          - - operator: isEqualString
              left:
                value:
                  simple: UserData.RiskLevel
                iscontext: true
              right:
                value:
                  simple: HIGH
              ignorecase: true
          accessor: Username
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -166.75,
          "y": 785
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "48":
    id: "48"
    taskid: cdc5cdc3-1f72-4739-b6b7-b4e9670965b1
    type: regular
    task:
      id: cdc5cdc3-1f72-4739-b6b7-b4e9670965b1
      version: -1
      name: Save risky user to evidence
      description: "Set a value in context under the key you entered. If no value is entered, the script doesn't do anything.\n\nThis automation runs using the default Limited User role, unless you explicitly change the permissions.\nFor more information, see the section about permissions here:\n- For Cortex XSOAR 6 see https://docs-cortex.paloaltonetworks.com/r/Cortex-XSOAR/6.x/Cortex-XSOAR-Playbook-Design-Guide/Automations \n- For Cortex XSOAR 8 Cloud see https://docs-cortex.paloaltonetworks.com/r/Cortex-XSOAR/8/Cortex-XSOAR-Cloud-Documentation/Create-a-script\n- For Cortex XSOAR 8.7 On-prem see https://docs-cortex.paloaltonetworks.com/r/Cortex-XSOAR/8.7/Cortex-XSOAR-On-prem-Documentation/Create-a-script"
      scriptName: SetAndHandleEmpty
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "56"
    scriptarguments:
      append:
        simple: "true"
      key:
        simple: Evidence.HighRiskUser
      value:
        simple: '${.=val.HighRiskUsername ? "True" : "False"}'
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -166.75,
          "y": 904
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "49":
    id: "49"
    taskid: 5c346458-7156-4a9e-b49e-8fe1d9b5436f
    type: regular
    task:
      id: 5c346458-7156-4a9e-b49e-8fe1d9b5436f
      version: -1
      name: Save IP prevalence value
      description: "Set a value in context under the key you entered. If no value is entered, the script doesn't do anything.\n\nThis automation runs using the default Limited User role, unless you explicitly change the permissions.\nFor more information, see the section about permissions here:\n- For Cortex XSOAR 6 see https://docs-cortex.paloaltonetworks.com/r/Cortex-XSOAR/6.x/Cortex-XSOAR-Playbook-Design-Guide/Automations \n- For Cortex XSOAR 8 Cloud see https://docs-cortex.paloaltonetworks.com/r/Cortex-XSOAR/8/Cortex-XSOAR-Cloud-Documentation/Create-a-script\n- For Cortex XSOAR 8.7 On-prem see https://docs-cortex.paloaltonetworks.com/r/Cortex-XSOAR/8.7/Cortex-XSOAR-On-prem-Documentation/Create-a-script"
      scriptName: SetAndHandleEmpty
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "56"
    scriptarguments:
      key:
        simple: IPNotPrevalent
      value:
        simple: '${.=val.Core && val.Core.AnalyticsPrevalence && val.Core.AnalyticsPrevalence.Ip && val.Core.AnalyticsPrevalence.Ip[0].data && val.Core.AnalyticsPrevalence.Ip[0].data.local_prevalence && val.Core.AnalyticsPrevalence.Ip[0].data.local_prevalence.value <= 0.5 ? "True" : "False"}'
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 245,
          "y": 780
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "50":
    id: "50"
    taskid: a48ef5c4-33b6-4f1f-a715-e629dfd0064d
    type: regular
    task:
      id: a48ef5c4-33b6-4f1f-a715-e629dfd0064d
      version: -1
      name: Save IP reputation
      description: Saves a context key indicating 1 if the IP is malicious and 0 if benign.
      scriptName: SetAndHandleEmpty
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "51"
    scriptarguments:
      key:
        simple: MaliciousIP
      value:
        complex:
          root: DBotScore
          filters:
          - - operator: isEqualString
              left:
                value:
                  simple: DBotScore.Type
                iscontext: true
              right:
                value:
                  simple: ip
              ignorecase: true
          - - operator: greaterThanOrEqual
              left:
                value:
                  simple: DBotScore.Score
                iscontext: true
              right:
                value:
                  simple: "3"
              ignorecase: true
          accessor: Indicator
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 639,
          "y": 780
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "51":
    id: "51"
    taskid: 492e8fcb-35e6-4660-8559-3d9953aa4262
    type: regular
    task:
      id: 492e8fcb-35e6-4660-8559-3d9953aa4262
      version: -1
      name: Save malicious IP to evidence
      description: "Set a value in context under the key you entered. If no value is entered, the script doesn't do anything.\n\nThis automation runs using the default Limited User role, unless you explicitly change the permissions.\nFor more information, see the section about permissions here:\n- For Cortex XSOAR 6 see https://docs-cortex.paloaltonetworks.com/r/Cortex-XSOAR/6.x/Cortex-XSOAR-Playbook-Design-Guide/Automations \n- For Cortex XSOAR 8 Cloud see https://docs-cortex.paloaltonetworks.com/r/Cortex-XSOAR/8/Cortex-XSOAR-Cloud-Documentation/Create-a-script\n- For Cortex XSOAR 8.7 On-prem see https://docs-cortex.paloaltonetworks.com/r/Cortex-XSOAR/8.7/Cortex-XSOAR-On-prem-Documentation/Create-a-script"
      scriptName: SetAndHandleEmpty
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "56"
    scriptarguments:
      append:
        simple: "true"
      key:
        simple: Evidence.MaliciousIP
      value:
        simple: '${.=val.MaliciousIP ? "True" : "False"}'
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 639,
          "y": 910
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "52":
    id: "52"
    taskid: 673dca3b-5f52-494d-8efe-077882f5d3d4
    type: regular
    task:
      id: 673dca3b-5f52-494d-8efe-077882f5d3d4
      version: -1
      name: Save related alerts to evidence
      description: "Set a value in context under the key you entered. If no value is entered, the script doesn't do anything.\n\nThis automation runs using the default Limited User role, unless you explicitly change the permissions.\nFor more information, see the section about permissions here:\n- For Cortex XSOAR 6 see https://docs-cortex.paloaltonetworks.com/r/Cortex-XSOAR/6.x/Cortex-XSOAR-Playbook-Design-Guide/Automations \n- For Cortex XSOAR 8 Cloud see https://docs-cortex.paloaltonetworks.com/r/Cortex-XSOAR/8/Cortex-XSOAR-Cloud-Documentation/Create-a-script\n- For Cortex XSOAR 8.7 On-prem see https://docs-cortex.paloaltonetworks.com/r/Cortex-XSOAR/8.7/Cortex-XSOAR-On-prem-Documentation/Create-a-script"
      scriptName: SetAndHandleEmpty
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "56"
    scriptarguments:
      append:
        simple: "true"
      key:
        simple: Evidence.RelatedAlerts
      value:
        simple: '${.=val.foundIncidents && val.foundIncidents.id ? "True" : "False"}'
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1047,
          "y": 785
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "53":
    id: "53"
    taskid: 640b108a-ceab-4d2b-8757-3e1c320dade9
    type: regular
    task:
      id: 640b108a-ceab-4d2b-8757-3e1c320dade9
      version: -1
      name: Save suspicious UA to evidence
      description: "Set a value in context under the key you entered. If no value is entered, the script doesn't do anything.\n\nThis automation runs using the default Limited User role, unless you explicitly change the permissions.\nFor more information, see the section about permissions here:\n- For Cortex XSOAR 6 see https://docs-cortex.paloaltonetworks.com/r/Cortex-XSOAR/6.x/Cortex-XSOAR-Playbook-Design-Guide/Automations \n- For Cortex XSOAR 8 Cloud see https://docs-cortex.paloaltonetworks.com/r/Cortex-XSOAR/8/Cortex-XSOAR-Cloud-Documentation/Create-a-script\n- For Cortex XSOAR 8.7 On-prem see https://docs-cortex.paloaltonetworks.com/r/Cortex-XSOAR/8.7/Cortex-XSOAR-On-prem-Documentation/Create-a-script"
      scriptName: SetAndHandleEmpty
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "56"
    scriptarguments:
      append:
        simple: "true"
      key:
        simple: Evidence.SuspiciousUserAgent
      value:
        simple: "True"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1465,
          "y": 785
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "54":
    id: "54"
    taskid: 9b24f909-6962-466d-8f9d-682092045601
    type: regular
    task:
      id: 9b24f909-6962-466d-8f9d-682092045601
      version: -1
      name: Save not suspicious UA to evidence
      description: "Set a value in context under the key you entered. If no value is entered, the script doesn't do anything.\n\nThis automation runs using the default Limited User role, unless you explicitly change the permissions.\nFor more information, see the section about permissions here:\n- For Cortex XSOAR 6 see https://docs-cortex.paloaltonetworks.com/r/Cortex-XSOAR/6.x/Cortex-XSOAR-Playbook-Design-Guide/Automations \n- For Cortex XSOAR 8 Cloud see https://docs-cortex.paloaltonetworks.com/r/Cortex-XSOAR/8/Cortex-XSOAR-Cloud-Documentation/Create-a-script\n- For Cortex XSOAR 8.7 On-prem see https://docs-cortex.paloaltonetworks.com/r/Cortex-XSOAR/8.7/Cortex-XSOAR-On-prem-Documentation/Create-a-script"
      scriptName: SetAndHandleEmpty
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "56"
    scriptarguments:
      append:
        simple: "true"
      key:
        simple: Evidence.SuspiciousUserAgent
      value:
        simple: "False"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1869,
          "y": 790
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "56":
    id: "56"
    taskid: 590c25be-f968-44c3-9281-a2f379365510
    type: condition
    task:
      id: 590c25be-f968-44c3-9281-a2f379365510
      version: -1
      name: Analyze evidence
      description: Analyzes the evidence to reach a verdict or the alert.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "58"
      True Positive:
      - "66"
    separatecontext: false
    conditions:
    - label: True Positive
      condition:
      - - operator: greaterThanOrEqual
          left:
            value:
              complex:
                root: Evidence
                transformers:
                - operator: jmespath
                  args:
                    expression:
                      value:
                        simple: '* | [?@ == ''True'']'
                - operator: count
            iscontext: true
          right:
            value:
              simple: "3"
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 448,
          "y": 1498
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "57":
    id: "57"
    taskid: 8156dcd8-aa8f-4255-99a0-f6489bdb1fc9
    type: title
    task:
      id: 8156dcd8-aa8f-4255-99a0-f6489bdb1fc9
      version: -1
      name: Remediation
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "60"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 448,
          "y": 1773
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "58":
    id: "58"
    taskid: d4db190a-8685-4bab-a1e1-5c5982b5e52e
    type: title
    task:
      id: d4db190a-8685-4bab-a1e1-5c5982b5e52e
      version: -1
      name: Inconclusive
      type: title
      iscommand: false
      brand: ""
      description: ''
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 867,
          "y": 1659
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "59":
    id: "59"
    taskid: dff481fa-2192-4bfe-9a56-ea5bdeb72c88
    type: regular
    task:
      id: dff481fa-2192-4bfe-9a56-ea5bdeb72c88
      version: -1
      name: Clear user session in Okta
      description: This script clears user sessions across multiple integrations for a list of usernames.
      scriptName: clear-user-session
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "63"
    scriptarguments:
      brands:
        simple: Okta v2
      user_name:
        simple: ${Core.OriginalAlert.event.auth_identity}
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 125,
          "y": 2028
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "60":
    id: "60"
    taskid: 0f7b02ac-f65c-4387-8d27-90a7da23712f
    type: condition
    task:
      id: 0f7b02ac-f65c-4387-8d27-90a7da23712f
      version: -1
      name: Check source vendor
      description: ""
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "69"
      Azure:
      - "64"
      Okta:
      - "59"
    separatecontext: false
    conditions:
    - label: Azure
      condition:
      - - operator: isEqualString
          left:
            value:
              simple: Core.OriginalAlert.raw_abioc.event.auth_server
            iscontext: true
          right:
            value:
              simple: Azure
          ignorecase: true
    - label: Okta
      condition:
      - - operator: isEqualString
          left:
            value:
              simple: Core.OriginalAlert.raw_abioc.event.auth_server
            iscontext: true
          right:
            value:
              simple: Okta
          ignorecase: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 448,
          "y": 1887
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "61":
    id: "61"
    taskid: e54224d1-7802-439d-b052-802fa96dedb4
    type: regular
    task:
      id: e54224d1-7802-439d-b052-802fa96dedb4
      version: -1
      name: Suspend user in Okta
      description: Suspends a single user. This operation can only be performed on users with an ACTIVE status. After the porcess is completed, the user's status is SUSPENDED.
      script: '|||okta-suspend-user'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "67"
    scriptarguments:
      username:
        simple: ${Core.OriginalAlert.event.auth_identity}
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 125,
          "y": 2307
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: true
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "63":
    id: "63"
    taskid: 0a6a3065-8b7d-456f-8c2e-81eccffc13c4
    type: condition
    task:
      id: 0a6a3065-8b7d-456f-8c2e-81eccffc13c4
      version: -1
      name: Analyst review - disable suspicious user?
      description: |
        We found suspicious indicators related to the user's connection or behavior and have taken action automatically by clearing the user's current sessions in Okta.

        Review the findings and decide if the user should also be suspended in Okta:

        ### Identity Information
        The identity that connected: `${Core.OriginalAlert.event.auth_identity}`

        User risk: `${.=val.HighRiskUsername ? "Risky" : "Not risky"}`

        ---

        ### Related Alerts
        Suspicious alerts found in the same case that may indicate that the user was compromised.

        Found alerts: `${.=val.foundIncidents && val.foundIncidents.length > 0 ? "True" : "False"}`

        Alert names (if found):
        `${foundIncidents.name}`

        ---

        ### Authentication Analysis
        User agent: `${Core.OriginalAlert.event.action_user_agent}`

        UA check result: `${.=val.Evidence && val.Evidence.SuspiciousUserAgent == "True" ? "Suspicious" : "Not suspicious"}`

        Source IP reputation result: `${.=val.MaliciousIP ? "Malicious" : "Not malicious"}`

        Source IP local prevalence: `${.=val.Core && val.Core.AnalyticsPrevalence && val.Core.AnalyticsPrevalence.Ip && val.Core.AnalyticsPrevalence.Ip[0].data && val.Core.AnalyticsPrevalence.Ip[0].data.local_prevalence && val.Core.AnalyticsPrevalence.Ip[0].data.local_prevalence.value <= 0.5 ? "Not prevalent" : "Prevalent"}`

        * The local prevalence of the IP indicates whether the IP is commonly seen in the organization.

        User authenticated without MFA: `${Evidence.OktaNoMFA}`

        Suspicious user activity observed in Okta logs: `${Evidence.OktaSuspiciousActivityLogs}`

        Connection is unusual for the user or the country is rarely used by other users: `${Evidence.UnusualConnection}`
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      "No":
      - "67"
      "Yes":
      - "61"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 125,
          "y": 2166
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    message:
      to:
      subject:
      body:
        complex:
          root: Core.OriginalAlert.event
          accessor: auth_identity
          transformers:
          - operator: concat
            args:
              prefix:
                value:
                  simple: "Would you like to disable the following user? \n"
              suffix: {}
      methods: []
      format: ""
      bcc:
      cc:
      timings:
        retriescount: 2
        retriesinterval: 360
        completeafterreplies: 1
        completeafterv2: true
        completeaftersla: false
      replyOptions:
      - "Yes"
      - "No"
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "64":
    id: "64"
    taskid: f66b4d43-3a61-4272-a986-a8666659b75f
    type: regular
    task:
      id: f66b4d43-3a61-4272-a986-a8666659b75f
      version: -1
      name: Clear user session in Azure AD
      description: This script clears user sessions across multiple integrations for a list of usernames.
      scriptName: clear-user-session
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "65"
    scriptarguments:
      brands:
        simple: Microsoft Graph User
      user_name:
        simple: ${Core.OriginalAlert.event.auth_identity}
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 766,
          "y": 2028
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "65":
    id: "65"
    taskid: 72aca50f-4640-42e2-846c-a7ae3910cf8a
    type: condition
    task:
      id: 72aca50f-4640-42e2-846c-a7ae3910cf8a
      version: -1
      name: Analyst review - disable suspicious user?
      description: |
        We found suspicious indicators related to the user's connection or behavior and have taken action automatically by clearing the user's current sessions in Azure AD.

        Review the findings and decide if the user should also be disabled in Azure AD:

        ### Identity Information
        The identity that connected: `${Core.OriginalAlert.event.auth_identity}`

        User risk: `${.=val.HighRiskUsername ? "Risky" : "Not risky"}`

        ---

        ### Related Alerts
        Suspicious alerts found in the same case that may indicate that the user was compromised.

        Found alerts: `${.=val.foundIncidents && val.foundIncidents.length > 0 ? "True" : "False"}`

        Alert names (if found):
        `${foundIncidents.name}`

        ---

        ### Authentication Analysis
        User agent: `${Core.OriginalAlert.event.action_user_agent}`

        UA check result: `${.=val.Evidence && val.Evidence.SuspiciousUserAgent == "True" ? "Suspicious" : "Not suspicious"}`

        Source IP reputation result: `${.=val.MaliciousIP ? "Malicious" : "Not malicious"}`

        Source IP local prevalence: `${.=val.Core && val.Core.AnalyticsPrevalence && val.Core.AnalyticsPrevalence.Ip && val.Core.AnalyticsPrevalence.Ip[0].data && val.Core.AnalyticsPrevalence.Ip[0].data.local_prevalence && val.Core.AnalyticsPrevalence.Ip[0].data.local_prevalence.value <= 0.5 ? "Not prevalent" : "Prevalent"}`

        *The local prevalence of the IP indicates whether the IP is commonly seen in the organization.

        User authenticated without MFA: `${Evidence.AzureNoMFA}`

        Active risk detections found for the user in Azure AD: `${Evidence.AzureRiskyUserDetections}`

        Connection is unusual for the user or the country is rarely used by other users: `${Evidence.UnusualConnection}`
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      "No":
      - "67"
      "Yes":
      - "68"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 766,
          "y": 2166
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    message:
      to:
      subject:
      body:
        complex:
          root: Core.OriginalAlert.event
          accessor: auth_identity
          transformers:
          - operator: concat
            args:
              prefix:
                value:
                  simple: "Would you like to disable the following user? \n"
              suffix: {}
      methods: []
      format: ""
      bcc:
      cc:
      timings:
        retriescount: 2
        retriesinterval: 360
        completeafterreplies: 1
        completeafterv2: true
        completeaftersla: false
      replyOptions:
      - "Yes"
      - "No"
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "66":
    id: "66"
    taskid: 2525410b-1dbd-4b7d-97ab-3297dca9dd69
    type: regular
    task:
      id: 2525410b-1dbd-4b7d-97ab-3297dca9dd69
      version: -1
      name: Increase alert severity
      description: Optionally increases the alert severity to the new value if it is greater than the existing severity.
      scriptName: IncreaseAlertSeverity
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "57"
    scriptarguments:
      severity:
        simple: Medium
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 448,
          "y": 1659
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "67":
    id: "67"
    taskid: 9a1a1e82-218b-4229-a183-bba8ce307f7c
    type: regular
    task:
      id: 9a1a1e82-218b-4229-a183-bba8ce307f7c
      version: -1
      name: Close the alert
      description: commands.local.cmd.close.inv
      script: Builtin|||closeInvestigation
      type: regular
      iscommand: true
      brand: Builtin
    scriptarguments:
      id:
        simple: ${alert.id}
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 448,
          "y": 2469
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "68":
    id: "68"
    taskid: f3d0d625-715e-4010-a32b-a98238f88f28
    type: regular
    task:
      id: f3d0d625-715e-4010-a32b-a98238f88f28
      version: -1
      name: Disable user in Azure AD
      description: |-
        Disables a user from all Office 365 applications, and prevents sign in. Note: This command disables user,
        but does not terminate an existing session. Supported only in a self deployed app flow with the
        Permission: Directory.AccessAsUser.All(Delegated).
      script: '|||msgraph-user-account-disable'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "67"
    scriptarguments:
      user:
        simple: ${Core.OriginalAlert.event.auth_identity}
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 766,
          "y": 2307
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: true
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "69":
    id: "69"
    taskid: 7e7388c2-c4b5-4446-8db2-cfa3a7ef792f
    type: regular
    task:
      id: 7e7388c2-c4b5-4446-8db2-cfa3a7ef792f
      version: -1
      name: Manual remediation
      description: "Automated remediation is not available for this authentication system. Manual remediation is required.\n        \n**User:** ${Core.OriginalAlert.event.auth_identity}\n\n**Authentication System:** ${Core.OriginalAlert.raw_abioc.event.auth_server}\n\n**Source Country:** ${Core.OriginalAlert.event.action_country}\n\n\n**Manual Remediation Steps:**\n\n**Immediate Actions:** Terminate any active user sessions in your authentication system to prevent continued access from the suspicious location. Reset the user's password and invalidate any existing authentication tokens or refresh tokens.\n        \n**Access Controls:** Temporarily disable the user account or implement conditional access policies to block connections from the suspicious country or IP range until the incident can be fully investigated and verified.\n        \n**MFA Enforcement:** Ensure multi-factor authentication is enabled and properly configured for the user. Consider requiring re-enrollment of MFA devices if there are concerns about device compromise."
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "67"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1199,
          "y": 2028
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "70":
    id: "70"
    taskid: 08fa6081-bcb0-497f-9d6f-af58eb682228
    type: title
    task:
      id: 08fa6081-bcb0-497f-9d6f-af58eb682228
      version: -1
      name: Connection Commonality Check
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "71"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 2366,
          "y": 520
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "71":
    id: "71"
    taskid: 27044c24-c7e0-45d5-ade7-b8671412eee5
    type: condition
    task:
      id: 27044c24-c7e0-45d5-ade7-b8671412eee5
      version: -1
      name: Check connection history
      description: "Set a value in context under the key you entered. If no value is entered, the script doesn't do anything.\n\nThis automation runs using the default Limited User role, unless you explicitly change the permissions.\nFor more information, see the section about permissions here:\n- For Cortex XSOAR 6 see https://docs-cortex.paloaltonetworks.com/r/Cortex-XSOAR/6.x/Cortex-XSOAR-Playbook-Design-Guide/Automations \n- For Cortex XSOAR 8 Cloud see https://docs-cortex.paloaltonetworks.com/r/Cortex-XSOAR/8/Cortex-XSOAR-Cloud-Documentation/Create-a-script\n- For Cortex XSOAR 8.7 On-prem see https://docs-cortex.paloaltonetworks.com/r/Cortex-XSOAR/8.7/Cortex-XSOAR-On-prem-Documentation/Create-a-script"
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "73"
      Unusual:
      - "72"
    scriptarguments:
      append:
        simple: "true"
      key:
        simple: RareConnection
    separatecontext: false
    conditions:
    - label: Unusual
      condition:
      - - operator: lessThanOrEqual
          left:
            value:
              simple: Core.OriginalAlert.event.norm_auth_user_identity_count_distinct_action_country_successful_sso
            iscontext: true
          right:
            value:
              simple: "1"
      - - operator: lessThanOrEqual
          left:
            value:
              simple: Core.OriginalAlert.event.action_country_count_distinct_users_sso_successful
            iscontext: true
          right:
            value:
              simple: "2"
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 2366,
          "y": 652
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "72":
    id: "72"
    taskid: 8f74a6c3-7934-4e7d-93e8-d9c80d205df1
    type: regular
    task:
      id: 8f74a6c3-7934-4e7d-93e8-d9c80d205df1
      version: -1
      name: Save connection as unusual
      description: "Set a value in context under the key you entered. If no value is entered, the script doesn't do anything.\n\nThis automation runs using the default Limited User role, unless you explicitly change the permissions.\nFor more information, see the section about permissions here:\n- For Cortex XSOAR 6 see https://docs-cortex.paloaltonetworks.com/r/Cortex-XSOAR/6.x/Cortex-XSOAR-Playbook-Design-Guide/Automations \n- For Cortex XSOAR 8 Cloud see https://docs-cortex.paloaltonetworks.com/r/Cortex-XSOAR/8/Cortex-XSOAR-Cloud-Documentation/Create-a-script\n- For Cortex XSOAR 8.7 On-prem see https://docs-cortex.paloaltonetworks.com/r/Cortex-XSOAR/8.7/Cortex-XSOAR-On-prem-Documentation/Create-a-script"
      scriptName: SetAndHandleEmpty
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "56"
    scriptarguments:
      append:
        simple: "true"
      key:
        simple: Evidence.UnusualConnection
      value:
        simple: "True"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 2366,
          "y": 805
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "73":
    id: "73"
    taskid: e8849d4b-8a2b-45bf-aee9-00812968f8d4
    type: regular
    task:
      id: e8849d4b-8a2b-45bf-aee9-00812968f8d4
      version: -1
      name: Save connection as not unusual
      description: "Set a value in context under the key you entered. If no value is entered, the script doesn't do anything.\n\nThis automation runs using the default Limited User role, unless you explicitly change the permissions.\nFor more information, see the section about permissions here:\n- For Cortex XSOAR 6 see https://docs-cortex.paloaltonetworks.com/r/Cortex-XSOAR/6.x/Cortex-XSOAR-Playbook-Design-Guide/Automations \n- For Cortex XSOAR 8 Cloud see https://docs-cortex.paloaltonetworks.com/r/Cortex-XSOAR/8/Cortex-XSOAR-Cloud-Documentation/Create-a-script\n- For Cortex XSOAR 8.7 On-prem see https://docs-cortex.paloaltonetworks.com/r/Cortex-XSOAR/8.7/Cortex-XSOAR-On-prem-Documentation/Create-a-script"
      scriptName: SetAndHandleEmpty
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "56"
    scriptarguments:
      append:
        simple: "true"
      key:
        simple: Evidence.UnusualConnection
      value:
        simple: "False"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 2811,
          "y": 805
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
view: |-
  {
    "linkLabelsPosition": {
      "20_21_Azure": 0.44,
      "20_22_Okta": 0.57,
      "32_31_no": 0.29,
      "38_28_yes": 0.52,
      "38_41_no": 0.42,
      "56_66_True Positive": 0.54,
      "60_59_Okta": 0.69,
      "63_61_Yes": 0.37,
      "63_67_No": 0.46,
      "65_67_No": 0.45,
      "65_68_Yes": 0.36
    },
    "paper": {
      "dimensions": {
        "height": 2513,
        "width": 5864,
        "x": -2672,
        "y": 26
      }
    }
  }
inputs: []
outputs: []
tests:
- No tests (auto formatted)
issilent: true
marketplaces: ["marketplacev2", "platform"]
fromversion: 8.9.0
description: ''
